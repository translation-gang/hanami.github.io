---
title: Руководство - Преобразования таблиц
---

# Миграции

## Преобразования таблиц

Следующие методы помогут преобразовать существующие таблицы:

  * `#add_column` (добавить поле, см.`#column`);
  * `#drop_column` (удалить поле);
  * `#rename_column` (переименовать поле, принимает первым аргументом **старое имя**, а вторым **новое имя**);
  * `#add_index` (добавить индекс, см. `#index`);
  * `#drop_index` (удалить индекс);
  * `#add_primary_key` (добавить первичный ключ, см. `#primary_key`);
  * `#add_foreign_key` (добавить внешний ключ, см. `#foreign_key`);
  * `#add_constraint` (добавить ограничение, см. `#constraint`);
  * `#drop_constraint` (удалить ограничение, принимает **имя** ограничения);
  * `#add_unique_constraint` (добавить ограничение по признаку уникальности записи);
  * `#set_column_default` (установить значение поля по умолчанию, принимает первым аргументом **имя поля** и вторым **значение по умолчанию**);
  * `#set_column_type` (установить тип данных поля, принимает первым аргументом **имя поля**, а вторым **тип данных**);
  * `#set_column_allow_null` (разраешает значение null для поля, принимает **имя поля**);
  * `#set_column_not_null` (запрещает значение null для поля, принимает **имя поля**).

Все эти методы принимают **имя таблицы в качестве первого аргумента** и только затем остальные.

Есть более короткий способ использовать их. Имя таблицы можно будет опустить, если вызывать методы **внутри блока** метода: `#alter_table`, который принимает в качестве первого аргумента **имя таблицы**.

Следующие примеры приведут к **одинаковому** результату:

```ruby
Hanami::Model.migration do
  change do
    add_column         :users, :email, String,  null: false, unique: true
    set_column_default :users, :visits_counts, default: 0
  end
end
```

Этот вариант, в отличии от первого, следует принципу DRY:

```ruby
Hanami::Model.migration do
  change do
    alter_table :users do
      # в следующих методах имя таблицы `users` передавать не нужно
      add_column :email, String,  null: false, unique: true    
      set_column_default :visits_counts, default: 0
    end
  end
end
```

### Переименование таблицы

Таблицы можно переименовать методом `#rename_table`. Он принимает **старое имя** в качестве первого аргумента и **новое имя** в качестве второго.

```ruby
rename_table :users, :people
```

### Удаление таблицы

Таблицы можно удалять методом `#drop_table`. Он принимает в качестве аргумента **имя таблицы**.

```ruby
drop_table :users
```

Есть более безопасный аналог этой операции `#drop_table?`. Он проверяет наличие таблицы перед удалением.
