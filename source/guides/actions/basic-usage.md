---
title: Guides - Actions Basic Usage
---

# Использование

## Обработка запросов

В [предыдущем разделе](/guides/actions/overview) мы создали действие. Попробуем использовать его.

Для начала разберемся с маршрутизацией:

```ruby
# apps/web/config/routes.rb
get '/dashboard', to: 'dashboard#index'
```

### Обработка представления

Изменим соответствующий шаблон::

```erb
# apps/web/templates/dashboard/index.html.erb
<h1>Dashboard</h1>
```
Обработка входящего запроса в Hanami происходит так:

  1. Маршрутизатор создает экземпляр объекта `Web::Controllers::Dashboard::Index` и вызывает `#call`.
  2. Приложение создает экземпляр `Web::Views::Dashboard::Index` и вызывает `#render`.
  3. Приложение возвращает ответ браузеру.

<p class="convention">
  По соглашению для действия с названием <code>Web::Controllers::Dashboard::Index</code>, должно быть соответствующее представление: <code>Web::Views::Dashboard::Index</code>.
</p>

Если мы запустим приложение и зайдем через браузер на `/dashboard`, то увидим `<h1>Dashboard</h1>`.

### Обход обработки представления

По умолчанию действие берет на себя заботу о статусе HTTP запроса и заголовке ответа, но не о теле ответа.
Как мы видели выше, обязанность составить его поручается _представлению_.

Иногда мы хотим пропустить этот шаг.
Например, мы хотим, чтобы в теле ответа содержалось что-то простое наподобие `OK`.
Задействовать слой представления в таком случае будет пустой тратой ресурсов процессора.

Тогда если мы укажем явно ответ внутри действия, то **приложение проигнорирует слой представления**.

```ruby
# apps/web/controllers/dashboard/index.rb
module Web::Controllers::Dashboard
  class Index
    include Web::Action

    def call(params)
      self.body = 'OK'
    end
  end
end
```

В таком случае Hanami обработает запрос так:

  1. Маршрутизатор создает экземпляр объекта `Web::Controllers::Dashboard::Index` и вызывает `#call`.
  2. Приложение обнаруживает, что тело ответа уже создано и не задействует представление.
  3. Приложение возвращает ответ браузеру.

Если мы запустим приложение и зайдем через браузер на `/dashboard`, то теперь увидим `OK`.

<p class="convention">
  Если тело ответа указано внутри действия, то обработка представления будет пропущена.
</p>

Явно задав тело ответа внутри действия **мы можем без последствий удалить соответствующие представление и шаблон**.

## Инициализация

Экземпляры объектов действий создаются во время выполнения программы: для каждого нового запроса автоматически создается новый экземпляр.
Благодаря объектной природе действий **мы можем проконтролировать процесс их инициализации** и, в частности,
[предоставить им внешние зависимости](http://en.wikipedia.org/wiki/Dependency_injection).
Эта техника особенно полезна для применения в модульных тестах.

```ruby
# apps/web/controllers/dashboard/index.rb
module Web::Controllers::Dashboard
  class Index
    include Web::Action

    def initialize(greeting: Greeting.new)
      @greeting = greeting
    end

    def call(params)
      self.body = @greeting.message
    end
  end
end
```

При этом всегда необходимо помнить об одном ограничении:

<p class="warning">
  Инициализатор действия ОБЯЗАН иметь 0 аргументов.
</p>

Такие инициализаторы считаются корректными:

```ruby
# аргументов нет совсем
def initialize
  # ...
end

# аргумент по умолчанию
def initialize(greeting = Greeting.new)
  # ...
end

# аргумент-символ
def initialize(greeting: Greeting.new)
  # ...
end

# опции
def initialize(options = {})
  # ...
end

# множественный аргумент
def initialize(*args)
  # ...
end
```
