---
title: "Руководство - Архитектура: Обзор"
---

# Архитектура

В основе Ханами лежит принцип [Чистой архитектуры(Clean Architecture)](https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html) и [стремление сохранения монолитной системы(Monolith First)](http://martinfowler.com/bliki/MonolithFirst.html).

## Чистая архитектура

Такая архитектура предназначена обеспечить **разделение ответственности(separation of concerns)** между **ядром** нашего приложения, которое осуществляет целевую функциональность, и **механизмами доставки**, которые посредством интерфейсов делают ее доступной внешнему миру.

В сгенерированном проекте находятся папки `lib/` и `apps/`. В них и базируются описанные выше части приложения.

### Ядро приложения

Наше приложение должно выполнять некоторый набор функций независимо от того, как будет организован доступ к ним из внешнего мира.
Это **краеугольный камень** нашего приложения и нам следует быть внимательными во время управления его зависимостями.

По умолчанию `Hanami::Model` обеспечивает сопровождение данных от интерфейсов до базы данных(persistence level). Эта часть приложения не имеет жестких зависимостей и может быть заменена в нашем `Gemfile`.

Посмотрим на папку `lib/` из только что сгенерированного проекта `bookshelf`, использующего `Hanami::Model`.

```shell
% tree lib
lib
├── bookshelf
│   ├── entities
│   ├── mailers
│   │   └── templates
│   └── repositories
└── bookshelf.rb

5 directories, 1 file
```
Задумка в том, чтобы разрабатывать приложение так же как и гем Руби.

Файл `lib/bookshelf.rb` является связующим звеном(entry point) между модулем и нашим приложением. Включая этот файл при помощи `require` мы включаем и весь код в папке `lib/`.

Здесь расположены две важные папки:

  * `lib/bookshelf/entities`
  * `lib/bookshelf/repositories`

Первая содержит [сущности](/guides/models/entities).
Это объекты Руби, которые составляют ядро модели. Они не должны обеспечивать хранение данных и механизмы транзакций.
Для этих целей мы выделили классы [репозиториев](/guides/models/repositories), которые определены во второй папке. Именно они выступают посредником между сущностями модели и базами данных.

Они работают в паре. Таким образом для сущности `Book` должен быть определен `BookRepository`.

Таких папок может быть столько, сколько понадобится. Так для нашего примера была создана  `lib/bookshelf/interactors`.

### Механизмы доставки

Ханами по умолчанию генерирует приложение с названием `Web`, расположенное в `apps/web`
Это приложение имеет **зависимости** в ядре нашего проекта: сущности, репозитории и другие определенные в нем объекты.

Это приложение используется как механизм доставки возможностей нашего продукта в веб.

```shell
% tree apps/web
apps/web
├── application.rb
├── assets
│   ├── favicon.ico
│   ├── images
│   ├── javascripts
│   └── stylesheets
├── config
│   └── routes.rb
├── controllers
├── templates
│   └── application.html.erb
└── views
    └── application_layout.rb

8 directories, 5 files
```

Коротко рассмотрим этот код.

Файл `apps/web/application.rb` содержит описание объекта Ханами-приложения `Web::Application`. В нем мы можем определить все настройки этого **компонента** проекта.
Папки `apps/web/controllers`, `views` и `templates` содержат [экшены(actions)](/guides/actions/overview), [представления(views)](/guides/views/overview) и [шаблоны(templates)](/guides/views/templates).

Загружаемые с HTML-страницей файлы, такие как код JavaScript и таблицы стилей автоматически становятся доступны после помещения их в `/apps/web/assets`.

## Монолитная система

Наше сгенерированное по умолчанию приложение `Web` будет использоваться в качестве источника пользовательского интерфейса.
Одним из возможных вариантов развития проекта может стать добавление интерфейса для администратора.

Мы не хотим чтобы наш проект предоставлял некоторые возможности в рамках главного пользовательского интерфейса(`Web`).
С другой стороны еще **слишком рано** переходить к микросервисной архитектуре просто ради возможности пользователя сбросить пароль.

Ханами предлагает решение нашей проблемы: мы можем сгенерировать новое приложение, которое будет работать в рамках того же процесса Руби, но при этом останется самостоятельным компонентом.

```shell
% bundle exec hanami generate app admin
```
Эта команда должна быть запущена из корневого каталога нашего проекта. Она создаст новое приложение(`Admin::Application`) в папке `apps/admin`.

На более поздней стадии развития проекта мы сможем переместить его и сделать полностью автономным.
Достаточно перенести папку `apps/admin` в отдельный репозиторий и развернуть приложение.

## Каркас приложения

Мы рассмотрели содержимое каталогов `lib/` и `apps/`, но есть и другие части нашего проекта заслуживающие внимания.

```shell
% tree -L 1
.
├── Gemfile
├── Gemfile.lock
├── Rakefile
├── apps
├── config
├── config.ru
├── db
├── lib
└── spec
```

Коротко скажем о них:

  * `Gemfile` и `Gemfile.lock` необходимы для функционирования [Bundler](http://bundler.io)
  * `Rakefile` описывает Rake-таски для нашего проекта.
  * `config/` содержит важный файл `config/environment.rb`, который является **отправной точкой(entry point)** нашего приложения. Вместе с ним включаются зависимости проекта(гемы Руби), модули Ханами и наш код.
  * `config.ru` файл, который описывает как Rack-сервер будет работать с нашими приложениями.
  * `db/` содержит файлы относящиеся к базам данных. Если проект использует реляционную базу данных, то он дополнительно включает `db/migrations` и `db/schema.sql`.
  * `spec/` содержит модульные и приемочные автоматизированные тесты.
