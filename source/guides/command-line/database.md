---
title: "Руководство - Командная строка: База данных"
---

# Командная строка

## База данных

В Ханами мы можем управлять базами данных прямо из командной строки.

**Из командной строки можно работать только со следующими реляционными базами данных:**

  * PostgreSQL
  * MySQL
  * SQLite3

[Адаптер базы данных](/guides/models/overview) для проекта `bookshelf` устанавливается в файле `lib/bookshelf.rb`.
Он будет использовать конфигурацию окружения из файла `.env.*` в корневом каталоге проекта.

### Создание

Команда `db create` создаст базу данных для текущего окружения.

```shell
% bundle exec hanami db create
```

Эта команда не может быть запущена в окружении `production`.

### Сброс

Команда `db drop` сбросит базу данных текущего окружения.

```shell
% bundle exec hanami db drop
```

Эта команда не может быть запущена в окружении `production`.

### Запуск миграций

Команда `db migrate` запустит [миграции](/guides/migrations/overview) из папки `db/migrations`.

Если есть следующие миграции:

```shell
% tree db/migrations
db/migrations
├── 20150613165259_create_books.rb
└── 20150613165900_create_authors.rb
```

То запуск `db migrate` приведет базу данных к _версии_ `20150613165900`, которая соответствует временной метке последней запущенной миграции.

```shell
% bundle exec hanami db migrate # Migrates to max migration (20150613165900)
```

Это команда может принимать необязательный аргумент с желаемой версией базы.
Например, если мы хотим **откатить** изменения миграции `20150613165900_create_authors.rb`, то мы можем запустить миграцию _**"в направлении вниз"**_.

```shell
% bundle exec hanami db migrate 20150613165259 # Миграция (вниз) to 20150613165259
```
**Эта команда доступна для любого окружения и любой реляционной базы данных.**
**This command is available in ALL the environments and ALL the SQL databases.**

### Подготовка

Команда подготовки базы данных текущего окружения, недоступна в окружении `production`.

После запуска `db prepare` будет:

  * Создана база данных;
  * Загружен дамп базы(если он есть, см. `db apply`);
  * Запущены все миграции.

```shell
% bundle exec hanami db prepare
```

Это команду следует использовать в качестве установщика базы данных.

### Apply

Это экспериментальная функция.

Когда приложение разрабатывается на протяжении лет, оно накапливает больше число миграций и это замедляет работу с базой данных в режиме разработки и тестирования.

Эта функция бывает не стабильна и поэтому может быть запущена только в окружении разработки.

После запуска `db apply` будут:

  * Запущены ожидающие миграции;
  * Создан дамп схемы новой базы в `db/schema.sql`;
  * Удалены все миграции в `db/migrations`.

```shell
% bundle exec hanami db apply
```

Команда доступна только в окружении разработки.

### Версия

Команда выводит версию текущей базы данных. Например, есть такие миграции:

```shell
% tree db/migrations
db/migrations
├── 20150613165259_create_books.rb
└── 20150613165900_create_authors.rb
```

После запуска миграций:

```shell
% bundle exec hanami db migrate
```

Версия базы будет такой:

```shell
% bundle exec hanami db version
20150613165900
```
